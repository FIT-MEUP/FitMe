<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì´í˜ì´ì§€</title>
    <link rel="stylesheet" href="../static/css/mypage.css">

</head>

<body>
    <div class="container">
        <!-- ìƒë‹¨ ë©”ë‰´ -->
        <div class="header">
            <button class="back-button">ëŒì•„ê°€ê¸°</button>
            <h1>ë§ˆì´í˜ì´ì§€</h1>
            <div class="header-right">
                <button class="notification-button">ğŸ””</button>
                <button class="edit-button">ìˆ˜ì •</button>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="main-content">
            <!-- ì™¼ìª½: ìº˜ë¦°ë” ë° PT ì´ë ¥ -->
            <div class="sidebar">
                <div class="date-display" id="date-display">2025.02</div>
                <div class="calendar-navigation">
                    <button class="prev-month-button" onclick="changeMonth(-1)">â—€</button>
                    <button class="next-month-button" onclick="changeMonth(1)">â–¶</button>
                </div>
                <table class="calendar" id="calendar"></table>
                <button class="pt-history-button">PT ì´ë ¥</button>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ì‚¬ìš©ì ì •ë³´ ë° ê·¸ë˜í”„ -->
            <div class="content">
                <h2>ìµœìš©ì¬ ë‹˜</h2>
                <table class="user-info">
                    <tr>
                        <th>ì´ë¦„</th>
                        <th>ë‚˜ì´</th>
                        <th>ì„±ë³„</th>
                        <th>í‚¤</th>
                        <th>ì²´ì¤‘</th>
                        <th>BMI</th>
                        <th>ì²´ì§€ë°©ë¥ </th>
                        <th>ê³¨ê²©ê·¼</th>
                        <th>ê¸°ì´ˆëŒ€ì‚¬ëŸ‰</th>
                    </tr>
                    <tr>
                        <td id="name">ìµœìš©ì¬</td>
                        <td id="age">25</td>
                        <td id="gender">ë‚¨ì„±</td>
                        <td id="height">175 cm</td>
                        <td id="weight">70 kg</td>
                        <td id="bmi">22.9</td>
                        <td id="bodyFat">18%</td>
                        <td id="muscleMass">30%</td>
                        <td id="bmr">1600 kcal</td>
                    </tr>
                </table>



                <!-- ê·¸ë˜í”„ ë²„íŠ¼ë“¤ -->
                <div class="graphs">
                    <div class="graph" id="weight-graph" onclick="showGraph('weight')">ì²´ì¤‘ ê·¸ë˜í”„</div>
                    <div class="graph" id="muscle-graph" onclick="showGraph('muscle')">ê³¨ê²©ê·¼ ê·¸ë˜í”„</div>
                    <div class="graph" id="bodyFat-graph" onclick="showGraph('fat')">ì²´ì§€ë°© ê·¸ë˜í”„</div>
                </div>

                <!-- ê·¸ë˜í”„ í‘œì‹œ ì˜ì—­ -->
                <div id="graph-container">
                    <canvas id="graphCanvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript ì—°ê²° -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let currentYear = new Date().getFullYear(); // í˜„ì¬ ì—°ë„
        let currentMonth = new Date().getMonth(); // í˜„ì¬ ì›” (0ë¶€í„° ì‹œì‘, 0 = 1ì›”)
        let selectedDate = new Date(); // ê¸°ë³¸ ë‚ ì§œëŠ” í˜„ì¬ ë‚ ì§œ
        let chartInstance = null; // ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜



        // ë‹¬ë ¥ ìƒì„± í•¨ìˆ˜
        function createCalendar() {
            const calendarElement = document.getElementById("calendar");
            const dateDisplay = document.getElementById("date-display");

            // í•´ë‹¹ ì›”ì˜ ì²« ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚  êµ¬í•˜ê¸°
            const firstDay = new Date(currentYear, currentMonth, 1).getDay(); // ì²« ë²ˆì§¸ ë‚ ì˜ ìš”ì¼ (0=ì¼, 1=ì›”, ...)
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate(); // í•´ë‹¹ ì›”ì˜ ì¼ìˆ˜

            // ë‚ ì§œ í‘œì‹œ (í˜•ì‹: 2025.02.19ì¼ ì›”ìš”ì¼)
            const monthName = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            const dayOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const firstDayOfWeek = new Date(currentYear, currentMonth, 1).getDay();

            // ì„ íƒëœ ë‚ ì§œì˜ í˜•ì‹í™” 
            const selectedDateText = `${currentYear}.${monthName[currentMonth]}`;
            dateDisplay.textContent = selectedDateText;

            // ë‹¬ë ¥ í—¤ë” (ìš”ì¼ í‘œì‹œ)
            const headerRow = document.createElement("tr");
            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            weekdays.forEach(day => {
                const th = document.createElement("th");
                th.textContent = day;
                headerRow.appendChild(th);
            });
            calendarElement.innerHTML = ''; // ê¸°ì¡´ ë‹¬ë ¥ ì´ˆê¸°í™”
            calendarElement.appendChild(headerRow);

            // ë‹¬ë ¥ ë‚´ìš© (í•´ë‹¹ ì›”ì˜ ë‚ ì§œ í‘œì‹œ)
            let currentDay = 1;
            for (let i = 0; i < 6; i++) { // ìµœëŒ€ 6ì£¼
                const row = document.createElement("tr");
                for (let j = 0; j < 7; j++) {
                    const td = document.createElement("td");
                    if (i === 0 && j < firstDay) {
                        td.textContent = ''; // ì²« ì£¼ì˜ ë¹ˆ ê³µê°„
                    } else if (currentDay <= daysInMonth) {
                        td.textContent = currentDay;

                        // í˜„ì¬ì˜ ë‚ ì§œ ê°’ì„ ë³„ë„ì˜ ë³€ìˆ˜ì— ì €ì¥í•´ì„œ ìº¡ì²˜
                        let day = currentDay;
                        td.onclick = function () { onDateClick(day); }; // ë‚ ì§œ í´ë¦­ ì´ë²¤íŠ¸


                        if (currentDay === selectedDate.getDate()) {
                            td.style.backgroundColor = '#c0e0ff'; // ì„ íƒëœ ë‚ ì§œ í•˜ì´ë¼ì´íŠ¸
                        }
                        currentDay++;
                    }
                    row.appendChild(td);
                }
                calendarElement.appendChild(row);
            }

        }
        // ë‚ ì§œ í´ë¦­ ì‹œ ë™ì‘í•˜ëŠ” í•¨ìˆ˜
        function onDateClick(day) {
            // ì„ íƒëœ ë‚ ì§œê°€ í•´ë‹¹ ì›”ì— ë§ê²Œ ì—…ë°ì´íŠ¸
            selectedDate = new Date(currentYear, currentMonth, day);
            console.log(selectedDate);
            createCalendar(); // ë‹¬ë ¥ ìƒˆë¡œ ê·¸ë¦¬ê¸°
            updateUserInfo(); // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
        }

        // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateUserInfo() {
            const dateDisplay = document.getElementById("date-display");
            const dayOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            dateDisplay.textContent = `${currentYear}.${monthNames[currentMonth]} ${selectedDate.getDate()}ì¼ (${dayOfWeek[selectedDate.getDay()]})`;
        }

        // ì›” ë³€ê²½ í•¨ìˆ˜
        function changeMonth(offset) {
            currentMonth += offset; // ë‹¤ìŒ/ì´ì „ ì›”ë¡œ ì´ë™
            if (currentMonth < 0) {
                currentMonth = 11; // 1ì›”ë¡œ ëŒì•„ê°
                currentYear--; // ì—°ë„ ê°ì†Œ
            } else if (currentMonth > 11) {
                currentMonth = 0; // 12ì›”ì—ì„œ 1ì›”ë¡œ ì´ë™
                currentYear++; // ì—°ë„ ì¦ê°€
            }
            createCalendar(); // ë‹¬ë ¥ ìƒˆë¡œ ê·¸ë¦¬ê¸°
        }

        // ê·¸ë˜í”„ ì„ íƒ í•¨ìˆ˜
        function showGraph(type) {
            const graphContainer = document.getElementById("graph-container");
            const graphCanvas = document.getElementById("graphCanvas");
            graphContainer.style.display = 'block'; // ê·¸ë˜í”„ ì˜ì—­ ë³´ì´ê¸°
            const ctx = graphCanvas.getContext('2d');
            const data = generateGraphData(type); // ê·¸ë˜í”„ ë°ì´í„° ìƒì„±

            // ê¸°ì¡´ì— ìƒì„±ëœ ì°¨íŠ¸ê°€ ìˆë‹¤ë©´ ì œê±°
            if (chartInstance) {
                chartInstance.destroy();
            }


            // ìƒˆ ì°¨íŠ¸ ìƒì„± ë° ì „ì—­ ë³€ìˆ˜ì— í• ë‹¹
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                    },
                },
            });
        }


        // ì„ íƒëœ ê·¸ë˜í”„ì— ë§ëŠ” ë°ì´í„° ìƒì„± í•¨ìˆ˜
        function generateGraphData(type) {
            const labels = Array.from({ length: 31 }, (_, i) => `${i + 1} ì¼`);
            let data = [];

            switch (type) {
                case 'weight':
                    data = [60, 62, 64, 63, 65, 66, 67, 68, 69, 70,];
                    break;
                case 'muscle':
                    data = [10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 64, 66, 68, 70];
                    break;
                case 'fat':
                    data = [20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 2, 2, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0];
                    break;
            }

            return {
                labels: labels,
                datasets: [{
                    label: type === 'weight' ? 'ì²´ì¤‘' : type === 'muscle' ? 'ê³¨ê²©ê·¼' : 'ì²´ì§€ë°©',
                    data: data,
                    fill: false,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    tension: 0.1
                }]
            };
        }

        // í˜ì´ì§€ ë¡œë”© ì‹œ ë‹¬ë ¥ ìƒì„±
        createCalendar();
    </script>
</body>

</html>