<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 페이지</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- FontAwesome -->
    <script src="https://kit.fontawesome.com/def97ee41b.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container mt-4">
        <!-- 로그아웃 버튼 -->
        <button class="btn btn-primary float-end">로그아웃</button>
        
        <h2 class="text-center">관리자 페이지</h2>

        <!-- 트레이너 목록 -->
        <h3 class="mt-4">트레이너 목록</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>번호</th>
                    <th>이름</th>
                    <th>프로필 확인</th>
                    <th>삭제</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="trainer : ${trainerList}">
                    <td th:text="${trainer.userId}"></td>
                    <td th:text="${trainer.userName}"></td>
                    <td><button class="btn btn-primary">O</button></td>
                    <td><button class="btn btn-danger" th:onclick="deleteTrainer([[${trainer.userId}]])">삭제</button></td>
                </tr>
            </tbody>
        </table>

        <!-- 트레이너 승인 -->
        <h3 class="mt-4">트레이너 승인</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>프로필 확인</th>
                    <th>승인</th>
                    <th>거절</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="trainer : ${pendingTrainerList}">
                    <td><button class="btn btn-primary">O</button></td>
                    <td><button class="btn btn-success" th:onclick="approveTrainer([[${trainer.userId}]])">✔</button></td>
                    <td><button class="btn btn-danger" th:onclick="rejectTrainer([[${trainer.userId}]])">✘</button></td>
                </tr>
            </tbody>
        </table>

        <!-- 회원 목록 -->
        <h3 class="mt-4">회원 목록</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>번호</th>
                    <th>이름</th>
                    <th>수정</th>
                    <th>삭제</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="user : ${userList}">
                    <td th:text="${user.userId}"></td>
                    <td th:text="${user.userName}"></td>
                    <td><button class="btn btn-primary" th:onclick="editUser([[${user.userId}]])">수정</button></td>
                    <td><button class="btn btn-danger" th:onclick="deleteUser([[${user.userId}]])">삭제</button></td>
                </tr>
            </tbody>
        </table>

        <!-- 헬스장 공지사항 -->
        <h3 class="mt-4">헬스장 공지사항</h3>
        <textarea class="form-control" id="noticeText" rows="3" placeholder="공지사항을 입력하세요..."></textarea>
        <button class="btn btn-success mt-2" onclick="updateNotice()">공지사항 반영</button>
    </div>

    <script>
        function deleteTrainer(userId) {
            if (confirm("정말 삭제하시겠습니까?")) {
                fetch(`/admin/deleteTrainer/${userId}`, { method: "DELETE" })
                    .then(response => response.json())
                    .then(data => location.reload());
            }
        }

        function approveTrainer(userId) {
            fetch(`/admin/approveTrainer/${userId}`, { method: "PUT" })
                .then(response => response.json())
                .then(data => location.reload());
        }

        function rejectTrainer(userId) {
            fetch(`/admin/rejectTrainer/${userId}`, { method: "DELETE" })
                .then(response => response.json())
                .then(data => location.reload());
        }

        function deleteUser(userId) {
            if (confirm("정말 삭제하시겠습니까?")) {
                fetch(`/admin/deleteUser/${userId}`, { method: "DELETE" })
                    .then(response => response.json())
                    .then(data => location.reload());
            }
        }

        function editUser(userId) {
            location.href = `/admin/editUser/${userId}`;
        }

        function updateNotice() {
            const text = document.getElementById("noticeText").value;
            fetch("/admin/updateNotice", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ notice: text })
            }).then(response => response.json()).then(data => alert("공지사항이 업데이트되었습니다!"));
        }
    </script>
</body>
</html>
