<!DOCTYPE html>
<html lang="ko" xmlns:th="http://thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>트레이너 상세 프로필</title>

    <!-- ✅ Tailwind CSS 추가 -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ✅ Google Fonts (Oswald + Montserrat 폰트 적용) -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- ✅ Bootstrap 추가 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        /* ✅ 폰트 스타일 */
        .font-title { font-family: 'Oswald', sans-serif !important; font-weight: 600; text-transform: uppercase; }
        .font-nav { font-family: 'Oswald', sans-serif !important; font-weight: 400; text-transform: uppercase; }
        .font-body { font-family: 'Montserrat', sans-serif !important; font-weight: 400; }
        
        /* ✅ 트레이너 프로필 카드 */
        .profile-card {
            background: #1f2937; /* Tailwind bg-gray-800 */
            color: white;
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        /* ✅ 더보기 버튼 */
        .more-photos {
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-weight: bold;
            border-radius: 8px;
            text-decoration: none;
            padding: 10px 0;
        }

        .more-photos:hover {
            background: rgba(0, 0, 0, 0.8);
            color: #facc15; /* Tailwind yellow-300 */
        }
    </style>
</head>

<body class="bg-gray-900 text-black" style="
    margin-top: 100px;">

	<div th:replace="~{fragment/header :: header}"></div>

    <!-- ✅ 컨텐츠 -->
    <div class="container mt-24">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- ✅ 트레이너 상세 사진 -->
            <div>
                <h3 class="text-2xl font-title mb-4 text-white">선생님 소개</h3>
                <div class="grid grid-cols-3 gap-2">
                    <div th:each="photo, stat : ${trainer.photos}" th:if="${stat.index < 6}">
                        <img th:src="${photo.photoUrl}" class="rounded-lg shadow-md" alt="Trainer Image">
                    </div>
                    <div th:if="${#lists.size(trainer.photos) > 6}">
                        <a href="#" class="more-photos flex justify-center items-center">더보기</a>
                    </div>
                </div>

                <div class="mt-4">
                    <p class="trainer-bio text-gray-300 font-body" th:text="${trainer.bio}"></p>
                </div>
            </div>

            <!-- ✅ 트레이너 프로필 정보 -->
            <div class="profile-card">
                <div class="text-center">
                    <img th:src="${trainer.photoUrl}" class="rounded-full mx-auto w-28 h-28 object-cover shadow-lg" alt="Trainer Profile">
                </div>
                <h4 class="mt-3 text-2xl font-title text-white-400" th:text="${trainer.user.userName} + ' 선생님'">트레이너 이름</h4>
                <p class="text-gray-400 text-sm font-body" th:text="${trainer.shortIntro}">짧은 자기소개</p>

                <p class="mt-3"><strong>전문 분야:</strong> <span th:text="${trainer.specialization}"></span></p>
                <p><strong>경력:</strong> <span th:text="${trainer.experience}"></span> 년</p>
                <p><strong>대표 가격 (회당):</strong> 
                    <span th:text="${#numbers.formatInteger(trainer.fee, 0, 'COMMA')}"></span> 원
                </p>
                    
					<!-- 상담 신청 또는 프로필 수정 버튼 -->
					<div class="text-center mt-3">
					    <!-- ✅ 1. 트레이너 사용자 -->
					    <div th:if="${isTrainer}">
					        <!-- ✅ 1-1. 자신의 프로필이면 "프로필 수정" 버튼 -->
					        <div th:if="${trainer.trainerId == loggedInTrainerId}">
					            <button class="btn btn-warning w-100" onclick="location.href='/trainer/edit'">
					                프로필 수정
					            </button>
					        </div>
					    </div>
					
					    <!-- ✅ 2. 일반 사용자 (트레이너가 아닌 경우) -->
						<div th:if="${not isTrainer}">
						    <!-- ✅ 2-1. 해당 트레이너에게 신청한 경우 -->
							<div th:if="${appliedToThis}">
							    <form th:action="@{/trainer/consultation/cancel}" method="post">
							        <input type="hidden" name="trainerId" th:value="${trainer.trainerId}" />
							        <button type="submit" class="btn btn-danger w-100">
							            신청 취소
							        </button>
							    </form>
							</div>
							
							<!-- ✅ 2-2. 아직 신청하지 않은 경우 (Rejected 상태 포함) -->
							<div th:if="${!appliedToAny}">
							    <form th:action="@{/trainer/consultation/apply}" method="post">
							        <input type="hidden" name="trainerId" th:value="${trainer.trainerId}" />
							        <button type="submit" class="btn btn-primary w-100">
							            방문 상담 신청
							        </button>
							    </form>
							</div>
							
							<!-- ✅ 2-3. 다른 트레이너에게 이미 신청한 경우 (신청 완료 버튼 비활성화) -->
							<div th:if="${appliedToAny and !appliedToThis}">
							    <button class="btn btn-secondary w-100" disabled>
							        신청 완료
							    </button>
							</div>
						</div>
					</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
