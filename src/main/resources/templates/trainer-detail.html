<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>트레이너 상세 프로필</title>
    
    <!-- Bootstrap 포함 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- 내 CSS -->
    <link rel="stylesheet" th:href="@{/css/trainer-detail.css}">
</head>

<body>
    <!-- 네비게이션 바 -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="/">Fit:Me</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
			<!-- 로그인 버튼의 링크를 /user/login으로 수정 -->
			<div id="user">
				<ul>
					<!-- 인증하지 않은 사용자 -->
					<th:block sec:authorize="isAnonymous()">
						<li><a th:href="@{/user/login}">로그인</a></li>
					</th:block>

					<!-- 인증한 사용자  -->
					<th:block sec:authorize="isAuthenticated()">
						<li><a th:href="@{/user/logout}">[[${#authentication.principal.displayName}]]님, 로그아웃</a></li>
					</th:block>
				</ul>
			</div>
		</div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- 왼쪽: 사진 & 긴 자기소개 -->
            <div class="col-md-7">
                <h3>선생님 소개</h3>

                <!-- 사진 갤러리 -->
                <div class="row g-2">
                    <div class="col-4" th:each="photo, stat : ${trainer.photos}" th:if="${stat.index < 8}">
                        <img th:src="${photo.photoUrl}" class="img-fluid rounded" alt="Trainer Image">
                    </div>
                    <div class="col-4" th:if="${#lists.size(trainer.photos) > 8}">
                        <a href="#" class="more-photos d-flex justify-content-center align-items-center">
                            더보기
                        </a>
                    </div>
                </div>

                <!-- 긴 자기소개 -->
                <div class="mt-3">
                    <p class="trainer-bio" th:text="${trainer.bio}"></p>
                </div>
            </div>

            <!-- 오른쪽: 트레이너 프로필 정보 -->
            <div class="col-md-5">
                <div class="profile-card p-4 shadow-sm rounded bg-white">
                    <!-- 대표 사진 -->
                    <div class="text-center">
                        <img th:src="${trainer.photoUrl}" 
                             class="rounded-circle img-fluid" 
                             style="width: 120px; height: 120px;" 
                             alt="Trainer Profile">
                    </div>

                    <!-- 트레이너 기본 정보 -->
                    <h4 class="text-center mt-3" th:text="${trainer.user.userName ?: '이름 없음'} + ' 선생님'">트레이너 이름</h4>
					<p class="text-center text-muted" th:text="${trainer.shortIntro ?: '소개 없음'}">짧은 자기소개</p>

                    <!-- 전문 분야 & 경력 -->
                    <p><strong>전문 분야:</strong> <span th:text="${trainer.specialization}"></span></p>
                    <p><strong>경력:</strong> <span th:text="${trainer.experience}"></span> 년</p>

                    <!-- PT 비용 -->
                    <p><strong>대표 가격 (회당):</strong> 
                        <span th:text="${#numbers.formatInteger(trainer.fee, 0, 'COMMA')}"></span> 원
                    </p>
                    
					<!-- 상담 신청 또는 프로필 수정 버튼 -->
					<div class="text-center mt-3" th:if="${loggedIn}">
					    <!-- 트레이너인 경우 -->
					    <div th:if="${isTrainer}">
					        <!-- isTrainer가 true이면 현재 프로필이 본인의 프로필 -->
					        <button class="btn btn-warning w-100" onclick="location.href='/trainer/edit'">
					            프로필 수정
					        </button>
					    </div>
					    <!-- 일반 사용자인 경우 -->
					    <div th:if="${not isTrainer}">
					        <!-- 사용자가 이미 상담 신청한 내역이 있는지 확인 -->
					        <div th:if="${appliedToAny}">
					            <!-- 현재 상세 페이지의 트레이너에 신청한 경우 -->
					            <div th:if="${appliedToThis}">
					                <form th:action="@{/trainer/consultation/cancel}" method="post">
					                    <input type="hidden" name="trainerId" th:value="${trainer.trainerId}" />
					                    <button type="submit" class="btn btn-danger w-100">
					                        신청 취소
					                    </button>
					                </form>
					            </div>
					            <!-- 다른 트레이너에 신청한 경우 -->
					            <div th:if="${!appliedToThis}">
					                <button class="btn btn-secondary w-100" disabled>
					                    신청 완료
					                </button>
					            </div>
					        </div>
					        <!-- 사용자가 아직 어떤 트레이너에도 신청하지 않은 경우 -->
					        <div th:if="${!appliedToAny}">
					            <form th:action="@{/trainer/consultation/apply}" method="post">
					                <input type="hidden" name="trainerId" th:value="${trainer.trainerId}" />
					                <button type="submit" class="btn btn-primary w-100">
					                    방문 상담 신청
					                </button>
					            </form>
					        </div>
					    </div>
					</div>
					<!-- 로그인하지 않은 경우 -->
					<div class="text-center mt-3" th:if="${not loggedIn}">
					    <button class="btn btn-outline-primary w-100" onclick="location.href='/user/login'">
					        로그인 후 신청 가능
					    </button>
					</div>					
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
