<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <!-- FullCalendar 라이브러리 -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="../../static/css/usercalendar.css" th:href="@{/css/userschedule.css}">
  <script src="../../static/js/jquery-3.7.1.min.js" th:src="@{/js/jquery-3.7.1.min.js}"></script>
  <script src="../../static/js/userschedule.js" th:src="@{/js/userschedule.js}"></script>
  
  <script th:inline="javascript">
var calendarEventsFromList = [
  /*[# th:each="event, iterStat : ${list}" ]*/
  {
    id: [[${event.trainerScheduleId}]],
    title:'이용시간',
    start: [[${#temporals.format(event.startTime, 'yyyy-MM-dd''T''HH:mm:ss')}]],
    end:   [[${#temporals.format(event.endTime, 'yyyy-MM-dd''T''HH:mm:ss')}]],
    editable: false
  }[(${iterStat.last ? '' : ','})]
  /*[/]*/
];

var calendarEventsUserList = [
  /*[# th:each="event, iterStat : ${userlist}" ]*/
  {
	scheduleId: [[${event.scheduleId}]],
    userId: [[${event.userId}]],
    title: [[${' ' + (event.userId != null ? event.userName : 'userName')}]],
    start: [[${#temporals.format(event.startTime, 'yyyy-MM-dd''T''HH:mm:ss')}]],
    end:   [[${#temporals.format(event.endTime, 'yyyy-MM-dd''T''HH:mm:ss')}]],
    editable: false,
    backgroundColor: ([[${event.userId}]] === [[${userId}]]) ? '#FF0000' : '#800080'
  }[(${iterStat.last ? '' : ','})]
  /*[/]*/
];

var calendarEvents = calendarEventsFromList.concat(calendarEventsUserList);
console.log("Merged calendarEvents:", calendarEvents);
</script>

<script th:inline="javascript">
    var trainerId = [[${trainerId}]];
    var userId = [[${userId}]];
    var userName = '[[${userName}]]';
</script>
</head>
<body>
  <div id="page-container">
    <!-- 왼쪽 사이드바 -->
    <div id="left-sidebar">
      <button id="diet-board">식단 게시판</button>
      <button id="exercise-board">운동 게시판</button>
      <div id="left-placeholder">여기에 나중에 글을 작성할 예정입니다.</div>
    </div>
    <!-- 중앙 캘린더 -->
    <div id="calendar"></div>
    <!-- 오른쪽 미니 캘린더 영역 -->
    <div id="mini-calendar-container">
      <div id="mini-calendar-wrapper">
        <div id="mini-calendar"></div>
      </div>
      <div id="month-placeholder"></div>
      <!-- 일정 선택 폼 (기본 숨김) -->
      <div id="schedule-form" style="display:none; margin-bottom:10px;">
        <label for="start-date">시작 날짜:</label>
        <input type="datetime-local" id="start-date">
        <p>분은 00분 또는 30분만 선택 가능합니다.</p>
      </div>
      <button id="pt-button">PT시작</button>
        <button id="delete-button">기존 일정 삭제</button>
      <div id="pt-info">잔여 PT : [[${changeAmount}]]</div>
      <!-- 신규: month view일 때 채팅박스 -->
      <div id="chat-box" style="display:none;">여기에 채팅 내용이 표시됩니다.</div>
    </div>
  </div>
</body>
</html>
