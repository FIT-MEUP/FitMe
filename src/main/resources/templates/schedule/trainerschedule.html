<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../../static/css/trainercalendar.css" th:href="@{/css/trainerschedule.css}">
  <script src="../../static/js/jquery-3.7.1.min.js" th:src="@{/js/jquery-3.7.1.min.js}"></script>
  
<script th:inline="javascript">
var calendarEventsFromList = [
  /*[# th:each="event, iterStat : ${list}" ]*/
  {
    id: [[${event.trainerScheduleId}]],
    title:'이용시간' ,
    start: [[${#temporals.format(event.startTime, 'yyyy-MM-dd''T''HH:mm:ss')}]],
    end:   [[${#temporals.format(event.endTime, 'yyyy-MM-dd''T''HH:mm:ss')}]],
    editable: false
  }[(${iterStat.last ? '' : ','})]
  /*[/]*/
];

var calendarEventsUserList = [
  /*[# th:each="event, iterStat : ${userlist}" ]*/
  {
    userId: [[${event.userId}]],
    title: [[${' ' + (event.userId != null ? event.userName : 'No User')}]],
    start: [[${#temporals.format(event.startTime, 'yyyy-MM-dd''T''HH:mm:ss')}]],
    end:   [[${#temporals.format(event.endTime, 'yyyy-MM-dd''T''HH:mm:ss')}]],
    editable: false,
    backgroundColor: '#800080'  // 보라색 지정 (필요시 textColor 등도 추가 가능)
  }[(${iterStat.last ? '' : ','})]
  /*[/]*/
];

var calendarEvents = calendarEventsFromList.concat(calendarEventsUserList);
console.log("Merged calendarEvents:", calendarEvents);
</script>
<script th:inline="javascript">
    var trainerId = [[${trainerId}]];
    var realTrainerId = [[${realTrainerId}]];
    // trainerId가 1이라면, 자바스크립트 변수 trainerId에 1이 할당됩니다.
</script>



  
  <script src="../../static/js/trainerschedule.js" th:src="@{/js/trainerschedule.js}"></script>
</head>
<body class="bg-gray-900 text-white" style="
    margin-top: 100px;">

	<header class="fixed top-0 left-0 w-full z-50 bg-black bg-opacity-80 shadow-lg">
    <div class="flex justify-between items-center px-6 py-4">
        <!-- 로고 -->
        <a href="/" class="text-3xl font-title">
            <img src="../../static/images/logo.png" th:src="@{/images/logo.png}" alt="Logo" class="h-12">
        </a>

        <!-- 네비게이션 메뉴 -->
        <nav class="hidden md:flex gap-10 text-lg font-nav pl-55">
            <a href="/" class="text-white hover:text-blue-400 transition"> 홈</a>
            <a href="javascript:void(0);" onclick="scrollToTrainers()" class="text-white hover:text-blue-400 transition"> 트레이너 찾기</a>
            <a href="#" class="text-white hover:text-blue-400 transition"> 식단 플래너</a>
            <a href="#" class="text-white hover:text-blue-400 transition"> 운동 다이어리</a>
            <a href="#" class="text-white hover:text-blue-400 transition"> 예약 및 일정</a>
            <a href="/videos" class="text-white hover:text-blue-400 transition"> 운동영상</a>
            <a href="/BMI" class="text-white hover:text-blue-400 transition">비만 자가진단</a>
        </nav>

        <!-- ✅ 로그인 상태 체크 후 UI 변경 -->
        <div class="flex gap-6">
            <th:block sec:authorize="isAnonymous()">
                <a th:href="@{/user/login}"
                   class="bg-blue-600 px-5 py-2 rounded-lg hover:bg-blue-700 transition font-nav">
                    로그인
                </a>
            </th:block>

            <th:block sec:authorize="isAuthenticated()">
                <div class="relative">
                    <button class="bg-gray-700 text-white px-5 py-2 rounded-lg hover:bg-gray-800 transition font-nav"
                            id="userMenu" onclick="toggleDropdown()">
                        [[${#authentication.principal.displayName}]]
                    </button>
                    <div id="dropdownMenu" class="absolute right-0 mt-2 w-40 bg-gray-800 text-white border border-gray-700 rounded-lg shadow-lg hidden">
                        <a class="block px-4 py-2 text-white hover:bg-gray-700 transition" th:href="@{/user/logout}"> 로그아웃</a>
                        <a class="block px-4 py-2 text-red-400 hover:bg-red-600 transition" th:href="@{/user/deleteAccount}"> 회원 탈퇴</a>
                    </div>
                </div>
            </th:block>
        </div>
    </div>
</header>

<script>
    function toggleDropdown() {
        var dropdown = document.getElementById("dropdownMenu");
        dropdown.classList.toggle("hidden");
    }

    // 클릭 외부 감지하여 닫기
    document.addEventListener("click", function(event) {
        var dropdown = document.getElementById("dropdownMenu");
        var button = document.getElementById("userMenu");
        if (!button.contains(event.target) && !dropdown.contains(event.target)) {
            dropdown.classList.add("hidden");
        }
    });
</script>

  <div id="page-container">
    <!-- 왼쪽 사이드바 -->
    <div id="left-sidebar">
      <a th:href="@{/trainer/memberManage}">
        <button id="member-management">회원관리</button>
      </a>
      <button id="schedule-management" style="display:none;">일정관리</button>
      <button id="reset-button" style="display:none;">초기화</button>
      <div id="left-placeholder">공지사항란</div>
      
    </div>
    <!-- 중앙 캘린더 -->
    <div id="calendar"></div>
    <!-- 오른쪽 미니 캘린더 영역 -->
    <div id="mini-calendar-container">
      <div id="mini-calendar-wrapper">
        <div id="mini-calendar"></div>
      </div>
      <div id="month-placeholder"></div>
      <button id="pt-button">PT시작</button>
    </div>
  </div>
  
  
</body>
</html>
